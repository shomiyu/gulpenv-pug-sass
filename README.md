# はじめに
## 概要

このリポジトリはgulpを使用してPug/Sassでコーディングをするための開発環境です。
gulpを使用するためには下記が必要となります。

- node.js
- xcodebuild(必要に応じて)

また、gulpfileの設定により`$ npx gulp`で下記の動作を行います。

- srcディレクトリ内をdistディレクトリにコンパイル
- browser-syncの立ち上げ
- distファイルがすでにある場合は一旦削除して再生成
- scssのコンパイル時にはベンダープレフィックスを付与
- js、cssは圧縮
- imagesディレクトリは階層構造を保ったままdist配下に複製
- pug/scssのコンパイルにエラーがあった場合はデスクトップ通知をする
- pug/scssファイルの監視

## 使用パッケージ
バージョンなどの情報はpackage.jsonをご覧ください。

- browser-sync
- del
- gulp
- gulp-autoprefixer
- gulp-cssmin
- gulp-notify
- gulp-plumber
- gulp-pug
- gulp-sass
- gulp-uglify

## ディレクトリ構成
基本的に**いじるのはsrcディレクトリ配下のみ**です。
srcディレクトリ配下で作成されたファイルは、ファイル構成を保ったままdistディレクトリにコンパイルされます。
ページを公開するときはdistディレクトリ内をサーバにアップロードします。

### セットアップ後のディレクトリ構成
セットアップが完了すると下記のディレクトリ構成になります。
(`★`が増えます。)

root
├─ dist(★)
    ├─ css
    ├─ images
    ├─ index.html
    ├─ js
├─ gulpfile.js
├─ node_modules(★)
├─ package.json
├─ README.md
└─ src
    ├─ images
    ├─ js
    ├─ pages
    ├─ scss

## srcディレクトリの概要
### imagesディレクトリ
画像ファイルが入ります。
ディレクトリ階層を保ったまま非圧縮でdist配下に複製されます。
(画像圧縮はしたいのでアップデート予定。)
画像の追加や変更は再度`$ npx gulp`を実行することで反映されます。

### jsディレクトリ
jsファイルが入ります。
圧縮してディレクトリ構成を保ったままdist配下に複製されます。
babelは入っていません。

### pagesディレクトリ
pugファイルが入ります。
ディレクトリの階層やHTMLのインデントを保ったままコンパイルされます。
includeする共通パーツは、`pages/_include/`配下に入れることでコンパイルの除外とします。
子階層のページにincludeする際にはパスにご注意ください。

### scssディレクトリ
scssファイルが入ります。
パーシャルファイルはファイル名をアンダーバー(_)から始めることでコンパイルの除外とします。
この環境では`/sec/scss/index.scss`ですべてをimportしていますが、お好みでカスタマイズしてください。

## セットアップ前に
必要な環境を揃えます。
node.jsとgulpがMacにインストールされていることを確認して、すでに入っている方は先に進んでください。

下記の通りにnode.jsとgulpのインストールを行います。

### node.jsのインストール
node.jsのインストールには2パターンあります。どちらかの方法でインストールしてください。
すでにnode.jsが入っている方は次に進んでください。

1.  [公式サイト](https://nodejs.org/ja/)からnode.jsの推奨版をインストール
2.  バージョン管理(nodenvなど)を使用してインストール
    下記の記事を参考にインストールを進めてください。
    - [nodenv を使って Mac に Node.js の環境を構築する](https://qiita.com/1000ch/items/41ea7caffe8c42c5211c)

コマンドラインで下記のように表示されればOKです。
```
$ node -v

$ npm -v
```

###

## セットアップ
package.jsonがあるディレクトリの階層で実行してください。

```
$ npm install

// 何もエラーが起きなければ続行
$ npx gulp

```

`$ npx gulp`を実行することでブラウザが立ち上がり、srcディレクトリで作業するとhtml、cssが自動的にコンパイルされます。

## セットアップトラブル時の対応
### npm installで失敗
1.  エラーの要因を解消
2.  node_modules、を削除
3.  再度`$ npm install`を実行する

※xcodebuildが必要な場合はインストールしてください。
成功するまで繰り返してください。
エラーの原因は各PC環境に依存していることが多いためここでは割愛します。。頑張ってください。

### npx gulpで失敗
1.  エラーの要因を解消
2.  再度`npx gulp`を実行する

※パスやファイルの読み込みがおかしくてエラーを吐くことが多いです。

## コマンドライン
```
// コンパイル開始
$ npx gulp
```
※gulpfileがある階層で実行しないとエラーになります。


## 最後に
みなさんの開発環境が少しでも楽になりますように！
